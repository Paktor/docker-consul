FROM alpine:3.2

ENV CONSUL_VERSION 0.5.2
ENV CONSUL_SHA256 171cf4074bfca3b1e46112105738985783f19c47f4408377241b868affa9d445
ENV CONSUL_ACL_DATACENTER ""
ENV CONSUL_ACL_DEFAULT_POLICY ""
ENV CONSUL_ACL_DOWN_POLICY ""
ENV CONSUL_ACL_MASTER_TOKEN ""
ENV CONSUL_ACL_TOKEN ""
ENV CONSUL_ACL_TTL ""
ENV CONSUL_ADVERTISE_ADDR ""
ENV CONSUL_ADVERTISE_ADDR_WAN ""
ENV CONSUL_BOOTSTRAP_EXPECT ""
ENV CONSUL_CHECK_UPDATE_INTERVAL ""
ENV CONSUL_DATA_DIR ""
ENV CONSUL_CLIENT_ADDR ""
ENV CONSUL_DATACENTER ""
ENV CONSUL_DISABLE_REMOTE_EXEC ""
ENV CONSUL_DISABLE_UPDATE_CHECK ""
ENV CONSUL_DNS_ALLOW_STALE ""
ENV CONSUL_DNS_ENABLE_TRUNCATE ""
ENV CONSUL_DNS_MAX_STALE ""
ENV CONSUL_DNS_NODE_TTL ""
ENV CONSUL_DNS_ONLY_PASSING ""
ENV CONSUL_DNS_SERVICE_TTL ""
ENV CONSUL_DOMAIN ""
ENV CONSUL_ENCRYPT ""
ENV CONSUL_LEAVE_ON_TERMINATE ""
ENV CONSUL_REJOIN_AFTER_LEAVE ""
ENV CONSUL_RETRY_JOIN ""
ENV CONSUL_RETRY_INTERVAL ""
ENV CONSUL_RETRY_INTERVAL_WAN ""
ENV CONSUL_SERVER ""
ENV CONSUL_SERVER_NAME ""
ENV CONSUL_SESSION_TTL_MIN ""
ENV CONSUL_SKIP_LEAVE_ON_INTERRUPT ""
ENV CONSUL_START_JOIN ""
ENV CONSUL_START_JOIN_WAN ""
ENV CONSUL_STATSD_ADDR ""
ENV CONSUL_STATSITE_ADDR ""
ENV CONSUL_STATSITE_PREFIX ""
ENV CONSUL_TLS_CA_FILE ""
ENV CONSUL_TLS_CERT_FILE ""
ENV CONSUL_TLS_VERIFY_INCOMING ""
ENV CONSUL_TLS_VERIFY_OUTGOING ""
ENV CONSUL_TLS_VERIFY_SERVER_HOSTNAME ""
ENV CONSUL_UI_DIR ""

RUN apk --update add curl ca-certificates jq && \
    curl -Ls https://circle-artifacts.com/gh/andyshinn/alpine-pkg-glibc/6/artifacts/0/home/ubuntu/alpine-pkg-glibc/packages/x86_64/glibc-2.21-r2.apk > /tmp/glibc-2.21-r2.apk && \
    apk add --allow-untrusted /tmp/glibc-2.21-r2.apk && \
    rm -rf /tmp/glibc-2.21-r2.apk /var/cache/apk/*
ADD https://dl.bintray.com/mitchellh/consul/${CONSUL_VERSION}_linux_amd64.zip /tmp/consul.zip
RUN echo "${CONSUL_SHA256}  /tmp/consul.zip" > /tmp/consul.sha256 \
  && sha256sum -c /tmp/consul.sha256 \
  && cd /bin \
  && unzip /tmp/consul.zip \
  && chmod +x /bin/consul \
  && rm /tmp/consul.zip
RUN mkdir /config
ADD ./bin/consul_launcher /bin/

ENTRYPOINT ["/bin/consul_launcher"]
